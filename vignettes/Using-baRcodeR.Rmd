---
title: "baRcodeR - label generation for tracking biological samples"
author: "Yihan Wu"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quick Start to Use baRcodeR}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

The baRcodeR package will generate unique IDs with 2-dimensional barcode tags in a pdf output format that can be printed using a laser printer and sticker sheets. Each function can be run interactively with prompts to guide label and barcode creation. 

> NOTE: When printing from pdf, ensure that 'anti-aliasing' or 'smoothing' options are turned OFF, and that you are not using 'fit to page' or similar options that will re-scale the output.

Creating unique, scannable 2-D barcodes involves two steps:

  1. Generate unique ID labels with `label_maker()` or `label_hier_maker()`
  2. Create a pdf file containing unique ID labels coupled with 2D barcode with `create_PDF()`

If you already have labels in a text file, skip step #1 and import labels into a `data.frame()` object for step #2: see [Create barcodes](#create-barcodes).

# Required packages 

'baRcodeR' requires four additional packages and their dependencies. 

```{r eval=F, include=T}
install.packages(c("ggplot2", "grDevices", "grid", "qrcode"))
```


# Create simple labels {#label-maker}

Simple one-level ID labels can be created using the 'label_maker()' function. One-level labels consist of two parts, a leading string shared by all samples and a number unique to each sample. 

For example, if we want to generate scannable barcode labels for 5 individuals:

```
example005
example006
example007
example008
example009
example010
```

First, load the `baRcodeR` library.

```{r eval=T, include=T}

library(baRcodeR)

```

## By user prompt {#label-maker-user-prompt}

Run the `label_make(r))` function in interactive mode.

```{r eval=F, include=T}
Labels <- label_maker(user = T)
```

User prompts will be shown in the console. Inputs received from the user are passed as parameters to the `label_maker()` to create the object `Labels`, which is a `data.frame()` object containing a vector of unique IDs in the first column, and additional columns for strings and individual numbers provided by the user. 

>  \> Please enter string for level: 

The string entered here defines the leading part of the label that will be the same for every label produced. This can be the name of a population, a species or a location. In this example, the string entered by the user into the console as denoted by the `>` symbol is "example".

>  \> Please enter string for level: example

The second user prompt is:

>  \> Enter the starting number for level: 

The prompt asks for the starting number to generate unique IDs. Labels produced do not have to start from 1. 

>  \> Enter the starting number for level: 5

The third user prompt is:

>  \> Enter the ending number for level: 

The prompt asks for the ending number. Unique IDs are generated sequentially from the starting number to the ending number. Note that a higher number can be used as the starting number to generate a reverse order. It is possible to generate IDs that are not sequentially numbered by passing a vector through `label_maker()` (e.g. `seq()`) (see [By arguments](#label-maker-arguments)) 

>  \> Enter the ending number for level: 10

After the starting and ending numbers are set, the function generates a series of numbers. The user is then asked for the number of digits in the unique ID. 

>  \> Number of digits to print for level:

This number must be >= the maximum number of digits in the Unique ID code and will add leading zeros and is particularly useful for generating IDs that are a small subset of a larger sample.

>  \> Number of digits to print for level: 3 


## By arguments {#label-maker-arguments}

It is also possible to create unique ID labels without user prompts by defining parameters directly in `label_maker`. The interactive example above can be reproduced by the code:

```{r eval=T, include=T}
Labels <- label_maker(string = "example", level = 5:10, digits = 3)
Labels
```

More complicated, non-sequential ID label codes can be generated via the `levels` parameter:

```{r eval=T, include=T}
number_sequence <- seq(1, 10, 2)
Labels <- label_maker(string = "example", level = number_sequence, digits = 3)
```

The output will then be:

```{r eval=T, include=F}
Labels
```

ID label codes can be saved to a text file for use with other programs (e.g. spreadsheet):

```{r eval=F, include=T}
write.csv(Labels, "Labels.csv")
```


# Create hierarchical labels {#label_hier_maker}

`label_hier_maker` is used to make unique ID codes that follow a hierarchical or nested structure. Similar to `label_maker`, this function can be run interactively or by directly defining parameters. In contrast to `label_maker`, `label_hier_maker` is used to generate nested pairs of strings and unique ID codes. Below is an example of a list of hierarchical labels with three levels (a, b, c) and varying numbers of individuals for each level (a=3, b=2, c=2). 

```
a1-b1-c1
a1-b1-c2
a1-b2-c1
a1-b2-c2
a2-b1-c1
a2-b1-c2
a2-b2-c1
a2-b2-c2
a3-b1-c1
a3-b1-c2
a3-b2-c1
a3-b2-c2
```



## By user prompts {#label-hier-maker-user-prompt}

To create the hierarchical ID labels using prompts, start with the argument `user=T` in the function.

```{r eval=F, include=T}
Labels <- label_hier_maker(user = T)
```

The prompt that appears in the console is:

>  \> What is the # of levels in hierarchy: 

In this example, we have levels a, b, and c; so three levels in total. 

>  \> What is the # of levels in hierarchy: 3

The second prompt asks if a string should be appended to the end of the IDs. 

>  \> String at end of barcode? (y/n):

There are only two possible responses to this question as indiciated in the parenthesis. If the answer is yes, then a new prompt will appear.

>  \> Please enter ending string: 

In this example, there is no ending string.

>  \> String at end of barcode? (y/n): n

For each level, there will be a series of prompts. The user will be able to set the string, the starting number, and the ending number for each level similar to the questions in `label_maker`(see [label_maker](#label-maker-user-prompt) for step by step instructions). The number of digits to print can also vary for each level. 

## By argument

Instead of interactive mode, it is possible to specify arguments directly into `label_hier_maker`. Unlike `label_maker`, a `list` object containing hierarchy parameters has to be input. Vectors should be created for each level in the hierarchy, and each vector should contain three parameters: the leading string, the start value, and the end value. The vectors should be input to a `list` object in the order of their hierarchy. For the example below, 'c' is nested within 'b' within 'a'. 

```{r}
level_one <- c("a", 1, 3)
level_two <- c("b", 1, 2)
level_three <- c("c", 10, 12)
hier_list <- list(level_one, level_two, level_three)
```

You can specify the ending string for all labels through the `end` argument and the number of digits to print for all levels through the `digits` argument. It is not possible at this time to vary the number of digits printed for each level, however this is possible in interactive mode using the prompts. 

The list can then be passed into `label_hier_maker`.

```{r, eval=T, include=T}
Labels <- label_hier_maker(hierarchy = hier_list, digits = 1)
```

The output will be:

```{r eval=T, include=T}
Labels
```


Labels can then be saved using:

```{r eval=F, include=T}
write.csv(Labels, "Labels.csv")
```



# Create barcodes {#create-barcodes}

2D barcodes are created from a set of text labels. Users can manually create their own labels in a the first column of a `data.frame()` object or create labels using `label_maker` or `label_hier_maker`. 

The function `create_PDF()` produces a pdf file containing barcodes that fit to the dimensions of ULINE Premium Laser Printer Labels #S-19297 (80 labels per sheet, 1.75" x 0.5"). If needed, the page setup can be modified using advanced options in [custom_create_PDF](#custom-create-pdf). 

The first step is to read in the labels, whether from a csv file or the output of `label_maker` or `label_hier_maker`. 

```{r eval=F, include=T}
# Reading in from a csv file
Labels<-read.csv("Labels.csv")
```

## By user prompt {#create-barcodes-user-prompt}

Here, using the hierarchical set of labels, a pdf file containing the labels will be created with the name "example.pdf", a font size of 3.5, and an error correction level "Q" meaning the barcode can tolerate up to 25% damage. The parameter `user=T` will prompt the user to guide creation of the pdf file containing scannable barcodes.

If `Labels` is a vector, the vector will be directly used to generate barcodes. If `Labels` is a data frame, the function will find a column called `label` and use that column, or the first column if there is no column called `label.` 

```{r eval=F, include=T}
create_PDF(user=T, Labels=Labels)
```
A user prompt is printed into the console. For example:

>  \> Please enter name for PDF output file: 

Any combination of letters and numbers can be used for the name of the pdf file. Here, the file name is set to "example."

>  \> Please enter name for PDF output file: example

The next user prompt is to set the size of the text printed on each barcode. 

>  \> Please enter a font size (2.2-4.7): 

This user input has to be a number between 2.2 and 4.7. In this example, the font size will be 3.5.

>  \> Please enter a font size (2.2-4.7): 3.5

It is possble that the labels are too long, or cannot fit on one row due to the size of the font selected. This will cause an error to print to console.

> ERROR: not enought space to print full label, please decrease font size.

The font size user prompt will appear again to reset to a more appropriate font size.  

>  \> Please enter a font size (2.2-4.7):

The last basic parameter to set is the error correction level. There are four possible levels: L, M, Q, and H. 

Level "L" - up to 7% damage -- ideal for very small labels (large pixels)
Level "M" - up to 15% damage
Level "Q" - up to 25% damage
Level "H" - up to 30% damage -- good for bigger labels (small pixels)

The user prompt for error correction level is similar to previous prompts.

>  \> Specify an error correction - L, M, Q, H: 

This example uses an error correction level "Q"

>  \> Specify an error correction - L, M, Q, H: Q

The last user prompt asks whether the user wants to modify the advanced parameters. 

>  \> Edit advanced parameters? (Y/N): 

In this example, no advanced parameters are modified. Using advanced parameters are covered in [advanced options](#custom-create-pdf)

>  \> Edit advanced parameters? (Y/N): N

## By arguments

The same example above can be reproduced directly with the following parameters:

```{r eval=F, include=T}
create_PDF(Labels = Labels, name = "example", ErrCorr = "Q", Fsz = 2.5)
```


# Advanced Options for pdf output {#custom-create-pdf}

There are advanced options for the pdf output which can be accessed interactively or by specifying additional arguments in `create_PDF`. The user prompts are similar to the ones shown above but allows customization of the output document for other printing formats. Documentation of the advanced options can be found using through the man page `?custom_create_PDF`.

Arguments can be passed from `create_PDF` to `custom_create_PDF` as `create_PDF` is just a wrapper for `custom_create_PDF`. 

```{r eval=F, include=T}

## This will create a pdf sheet where the labels are printed in columns then rows. It will skip 3 rows from the top and one column from the left. 
create_PDF(Labels = Labels, name = "example_advanced", ErrCorr = "Q", Fsz = 2.5, Across = F, ERows = 3, ECol = 1)
```





